import React, {Component, useState, useEffect} from 'react';
// import './App.css';
import AppRouter from "./component/RouterComponent";
import NavBar from "./component/Navbar";
import Container from '@material-ui/core/Container';
import axios from 'axios';


const App = () => {
    const [state, setState] = useState({
            data: [],
            _id: null,
            message: null,
            intervalIsSet: false,
            idToDelete: null,
            idToUpdate: null,
            objectToUpdate: null,
        }
    )

    useEffect(()=>{
        console.log('lll')
        // return ()=>{console.log('wychodze')}

    },[])
    
    useEffect(()=>{
        getDataFromDb();
        if (!state.intervalIsSet) {
            let interval = setInterval(getDataFromDb, 1000);
            setState({...state, intervalIsSet: interval });
        }

        return ()=>{
            if (state.intervalIsSet) {
            clearInterval(state.intervalIsSet);
                setState({...state, intervalIsSet: null });
            }
        }

    },[])

    // just a note, here, in the front end, we use the id key of our data object
  // in order to identify which we want to Update or delete.
  // for our back end, we use the object id assigned by MongoDB to modify
  // data base entries

  // our first get method that uses our backend api to
  // fetch data from our data base
  const getDataFromDb = () => {
    fetch('http://localhost:3001/api/getData')
      .then((data) => data.json())
      .then((res) => {
        if(res.data.length === 0){
          setState({...state, data: res.data })
        }
      });
  };

  // our put method that uses our backend api
  // to create new query into our data base
  // const putDataToDB = (message) => {
  //   let currentIds = state.data.map((data) => data.id);
  //   let idToBeAdded = 0;
  //   while (currentIds.includes(idToBeAdded)) {
  //     ++idToBeAdded;
  //   }

  //   axios.post('http://localhost:3001/api/putData', {
  //     _id: idToBeAdded,
  //     message: message,
  //   });
  // };

  // our delete method that uses our backend api
  // to remove existing database information
  const deleteFromDB = (idTodelete) => {
    parseInt(idTodelete);
    let objIdToDelete = null;
    state.data.forEach((dat) => {
      if (dat.id == idTodelete) {
        objIdToDelete = dat._id;
      }
    });

    axios.delete('http://localhost:3001/api/deleteData', {
      data: {
        id: objIdToDelete,
      },
    });
  };

  // our update method that uses our backend api
  // to overwrite existing data base information
  const updateDB = (idToUpdate, updateToApply) => {
    let objIdToUpdate = null;
    parseInt(idToUpdate);
    state.data.forEach((dat) => {
      if (dat.id == idToUpdate) {
        objIdToUpdate = dat._id;
      }
    });

    axios.post('http://localhost:3001/api/updateData', {
      id: objIdToUpdate,
      update: { message: updateToApply },
    });
  };

    return (
      <div>
          <NavBar/>
          <Container>
              {/* <button onClick={()=>setState({...state, id: state.id++})}>PRZYCISK KOTA</button> */}
                <AppRouter/>
          </Container>
      </div>
  );
}



export default App;